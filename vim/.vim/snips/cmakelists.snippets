# cmakelists.snippets - Snippets for cmakelists file type
# NOTE: This is a made up filetype and should only have specialized snippets

snippet mod_cath2 "Setup and include catch2 module" b
`mkdir cmake || test ! -f cmake/Catch2Helpers.cmake && cp ~/.vim/integrations/templates/cmake/Catch2Helpers.cmake cmake/Catch2Helpers.cmake`# Define create_catch2_test
include(cmake/Catch2Helpers.cmake)
find_package(Catch2 REQUIRED)
# NOTE: Depends on find_package(catch2) being found
create_catch2_test(TARGET
                   ${1:catch2_test}
                   SOURCES
                   ${2:test/${3:catch2_test}.cpp})$0
endsnippet

snippet mod_conan "Setup and include conan module" b
`mkdir cmake || test ! -f cmake/ConanHelpers.cmake && cp ~/.vim/integrations/templates/cmake/ConanHelpers.cmake cmake/ConanHelpers.cmake`# Define run_conan
include(cmake/ConanHelpers.cmake)
run_conan(REQUIRES ${1:fmt/6.1.2})
endsnippet

snippet mod_targetHelpers "Module for creating targets" b
`mkdir cmake || test ! -f cmake/TargetHelpers.cmake && cp ~/.vim/integrations/templates/cmake/TargetHelpers.cmake cmake/TargetHelpers.cmake`
include(cmake/TargetHelpers.cmake)

create_target(TARGET
              ${1:target_name}
              ${2:IS_LIBRARY}
              SOURCES
              ${3:src/${4:main}.cpp}
              INCLUDE
              ${5:include}
              LINK_LIBRARIES
              project_warnings
              project_options
              ${6:ExternalLib})
endsnippet

# Skeletons
snippet _cmakelists "Skeleton for files called CMakeLists.txt" b
cmake_minimum_required(VERSION `cmake --version | head -n 1 | sed 's/[ a-z]//g' | cut -d '.' -f1-2`)

project(${1:`!v split(getcwd(), '/')[-1] " Directory name`} VERSION 0.1 LANGUAGES CXX)

# Export compile flags to compile_commands.json database. Useful for linters and
# autocompletion
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

`mkdir cmake || test ! -f cmake/WarningsAndOptions.cmake && cp ~/.vim/integrations/templates/cmake/WarningsAndOptions.cmake cmake/WarningsAndOptions.cmake`
# Define project_warnings and project_options targets
include(cmake/WarningsAndOptions.cmake)
add_warnings(TARGET $1_warnings)
add_options(TARGET $1_options)

`mkdir cmake || test ! -f cmake/ProjectSettings.cmake && cp ~/.vim/integrations/templates/cmake/ProjectSettings.cmake cmake/ProjectSettings.cmake`
# Define options such as ccache
include(cmake/ProjectSettings.cmake)

`mkdir cmake || test ! -f cmake/Sanitizers.cmake && cp ~/.vim/integrations/templates/cmake/Sanitizers.cmake cmake/Sanitizers.cmake`
include(cmake/Sanitizers.cmake)

`mkdir cmake || test ! -f cmake/StaticAnalyzers.cmake && cp ~/.vim/integrations/templates/cmake/StaticAnalyzers.cmake cmake/StaticAnalyzers.cmake`
include(cmake/StaticAnalyzers.cmake)

`mkdir cmake || test ! -f cmake/CodeCoverage.cmake && cp ~/.vim/integrations/templates/cmake/CodeCoverage.cmake cmake/CodeCoverage.cmake`
include(cmake/CodeCoverage.cmake)

add_${2:executable}(${3:$1} ${4:src/${5:main}.cpp})
target_link_libraries($3
                      PRIVATE project_warnings project_options)
set_target_properties($3
                      PROPERTIES
                      CXX_STANDARD_REQUIRED
                      ON
                      CXX_EXTENSIONS
                      OFF
                      CXX_STANDARD
                      ${4:17})$0

# Only build tests and benchmarks if building this project directly
if(PROJECT_SOURCE_DIR STREQUAL CMAKE_SOURCE_DIR)
  option(ENABLE_TESTING "Build the testing tree" OFF)
  if(ENABLE_TESTING)
    # TODO: Add tests
    # enable_testing()
    # add_subdirectory(tests)
  endif()

  option(ENABLE_BENCHMARKS "Build the benchmarks" OFF)
  if(ENABLE_BENCHMARKS)
    # TODO: Add benchmarks
  endif()
endif()
endsnippet
